<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Chúc mừng sinh nhật vợ yêu 💖</title>
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
  <style>
    body {
      margin: 0;
      background: #ffc0cb;
      font-family: 'Segoe UI', sans-serif;
      overflow: hidden;
    }

    .start-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 100;
    }

    .envelope {
      position: relative;
      width: 140px;
      height: 100px;
      margin: 0 auto;
      cursor: pointer;
      transform-style: preserve-3d;
      perspective: 600px;
    }

    .envelope .flap {
      width: 140px;
      height: 50px;
      background: #e91e63;
      position: absolute;
      top: 0;
      transform-origin: top;
      transition: transform 0.6s ease;
      border-radius: 6px 6px 0 0;
      z-index: 2;
    }

    .envelope .body {
      width: 140px;
      height: 100px;
      background: white;
      text-align: center;
      font-size: 48px;
      line-height: 100px;
      border: 3px solid #e91e63;
      border-radius: 6px;
      position: relative;
      z-index: 1;
    }

    .click-text {
      font-size: 18px;
      margin-top: 12px;
      color: #b30047;
      font-weight: bold;
    }

    .message-box, .second-message, .couple-text {
      position: absolute;
      width: 100%;
      text-align: center;
      z-index: 10;
      display: none;
    }

    .message-box {
      top: 30px;
    }

    .second-message {
      bottom: 30px;
    }

    .couple-text {
      top: 20px;
    }

    .couple-text h1 {
      font-size: 3.5vw;
      color: #e91e63;
      text-shadow: 1px 1px 3px white;
      margin: 0;
      font-family: 'Great Vibes', cursive;
      font-weight: 400;
    }

    .message-box h1 {
      font-size: 2.5vw;
      color: #e91e63;
      margin-bottom: 1px;
      text-shadow: 1px 1px 3px white;
    }

    .typewriter {
      font-size: 1.2vw;
      color: white;
      background: rgba(255, 105, 180, 0.5);
      padding: 1vw 2vw;
      border-radius: 12px;
      display: inline-block;
      margin-top: 0.5vw;
    }

    .typewriter.no-bg {
      background: none;
      font-weight: bold;
      font-size: 1.4vw;
      color: #e91e63;
      margin-top: -2vw;
    }

    .center-img {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 13vw;
      height: 13vw;
      transform: translate(-50%, -50%);
      border-radius: 50%;
      object-fit: cover;
      box-shadow: 0 0 20px #fff;
      z-index: 6;
      display: none;
    }

    .orbit-img {
      position: absolute;
      width: 8vw;
      height: 8vw;
      border-radius: 10px;
      object-fit: cover;
      opacity: 0;
      transition: all 1s ease;
      z-index: 4;
    }

    .orbit-img.focus-enabled:hover {
      transform: scale(1.5);
      z-index: 5;
      box-shadow: 0 0 15px rgba(233, 30, 99, 0.8);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .center-img.focus-enabled:hover {
      transform: scale(1.5) translate(-50%, -50%);
      z-index: 7;
      box-shadow: 0 0 15px rgba(233, 30, 99, 0.8);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    #heart-path {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 7;
      pointer-events: none;
      filter: drop-shadow(0 0 10px #e91e63) blur(2px);
    }

    #heart-path path {
      stroke: #e91e63;
      stroke-width: 4;
      fill: none;
      stroke-dasharray: 3000;
      stroke-dashoffset: 3000;
      stroke-linecap: round;
      stroke-linejoin: round;
    }

    @keyframes drawHeart {
      to {
        stroke-dashoffset: 0;
      }
    }

    .lucky-wheel-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      text-align: center;
      z-index: 10;
      display: none;
    }

    .wheel {
      width: 300px;
      height: 300px;
      border-radius: 50%;
      position: relative;
      overflow: hidden;
      border: 5px solid #e91e63;
      background: #fff;
      transform: rotate(0deg);
      transition: transform 4s ease-out;
    }

    .wheel-segment {
      position: absolute;
      width: 50%;
      height: 50%;
      clip-path: polygon(0% 0%, 100% 0%, 50% 100%);
      transform-origin: 100% 100%;
      text-align: center;
      font-size: 14px;
      font-weight: bold;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
    }

    .spin-button {
      margin-top: 20px;
      padding: 10px 20px;
      font-size: 18px;
      font-weight: bold;
      background: #e91e63;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    .spin-button:hover {
      background: #b30047;
    }

    .spin-button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .result-text {
      margin-top: 10px;
      font-size: 18px;
      color: #e91e63;
      font-weight: bold;
      text-shadow: 1px 1px 3px white;
    }

    @media (max-width: 768px) {
      .message-box h1 {
        font-size: 6vw;
      }
      .couple-text h1 {
        font-size: 8vw;
      }
      .typewriter, .typewriter.no-bg {
        font-size: 4vw;
        padding: 2vw;
      }
      .typewriter.no-bg {
        font-size: 4vw;
        margin-top: -1vw;
      }
      .center-img {
        width: 40vw;
        height: 40vw;
      }
      .orbit-img {
        width: 25vw;
        height: 25vw;
      }
      .orbit-img.focus-enabled:hover {
        transform: scale(1.4);
      }
      .center-img.focus-enabled:hover {
        transform: scale(1.4) translate(-50%, -50%);
      }
      .wheel {
        width: 250px;
        height: 250px;
      }
      .wheel-segment {
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <audio id="bgm" loop>
    <source src="music/birthday.mp3" type="audio/mpeg" />
  </audio>
  <audio id="type-sound" src="sounds/keypress.mp3" preload="auto"></audio>

  <div class="start-container" onclick="openEnvelope(this)">
    <div class="envelope">
      <div class="flap"></div>
      <div class="body">💌</div>
    </div>
    <p class="click-text">Click để mở thư chúc mừng nhé 💞</p>
  </div>

  <div class="message-box">
    <h1>🎂Chúc mừng sinh nhật vợ yêu💌</h1>
    <div class="typewriter no-bg">
      <p id="typing-text"></p>
    </div>
  </div>

  <div class="couple-text">
    <h1>Quý Thanh 💗 Mỹ Linh</h1>
  </div>

  <img src="./images/happywife.jpg" class="center-img" alt="Vợ yêu" />

  <div class="second-message">
    <div class="typewriter">
      <p id="typing-text-2"></p>
    </div>
  </div>

  <svg id="heart-path">
    <path id="heart-curve" d="" />
  </svg>

  <canvas id="fireworks" style="position:absolute;top:0;left:0;width:100vw;height:100vh;z-index:8;pointer-events:none;"></canvas>

  <div class="lucky-wheel-container">
    <div class="wheel" id="lucky-wheel"></div>
    <button class="spin-button" onclick="spinWheel()">Quay Lì Xì</button>
    <div class="result-text" id="result-text"></div>
  </div>

  <script>
    const text = "Hôm nay là ngày đặc biệt, ngày em đến với thế giới này để rồi trở thành thế giới của anh. Cảm ơn em vì đã luôn bên anh. Yêu em rất nhiều! 💕";
    const text2 = "Chúc em một tuổi mới ngập tràn hạnh phúc, yêu thương và luôn mỉm cười thật tươi mỗi ngày! Hãy cùng nhau cố gắng hoàn thiện bản thân thành phiên bản tốt hơn mỗi ngày để cùng đạt được những mục tiêu phía trước nhé vợ 💖";
    const target = document.getElementById("typing-text");
    const target2 = document.getElementById("typing-text-2");
    const typeSound = document.getElementById("type-sound");
    const bgm = document.getElementById("bgm");
    const heartCurve = document.getElementById("heart-curve");
    const fireworksCanvas = document.getElementById("fireworks");
    const ctx = fireworksCanvas.getContext("2d");
    fireworksCanvas.width = window.innerWidth;
    fireworksCanvas.height = window.innerHeight;
    let index = 0;
    let orbitImgs = [];

    function openEnvelope(el) {
      const flap = el.querySelector(".flap");
      flap.style.transform = "rotateX(-120deg)";
      bgm.play().catch(() => {});
      setTimeout(() => {
        el.style.display = "none";
        startTyping();
      }, 800);
    }

    function startTyping() {
      document.querySelector(".message-box").style.display = "block";
      typeSound.loop = true;
      typeSound.play().catch(() => {});

      const interval = setInterval(() => {
        if (index < text.length) {
          target.innerHTML += text.charAt(index);
          index++;
        } else {
          clearInterval(interval);
          typeSound.pause();
          typeSound.currentTime = 0;
          showOrbitImages();
        }
      }, 50);
    }

    function showOrbitImages() {
      const centerImg = document.querySelector('.center-img');
      centerImg.style.display = 'block';

      const images = Array.from({ length: 10 }, (_, i) => `img${i + 1}.jpg`);
      const center = centerImg.getBoundingClientRect();
      const centerX = center.left + center.width / 2;
      const centerY = center.top + center.height / 2;
      const radius = center.width * 1.05;

      images.forEach((filename, i) => {
        const angle = (2 * Math.PI / images.length) * i;
        const x = centerX + radius * Math.cos(angle);
        const y = centerY + radius * Math.sin(angle);

        const img = document.createElement('img');
        img.src = `./images/${filename}`;
        img.className = 'orbit-img';
        img.style.left = `${x - center.width * 0.32}px`;
        img.style.top = `${y - center.width * 0.32}px`;
        img.style.opacity = '0';
        img.onerror = () => console.error(`Failed to load image: ${img.src}`);
        document.body.appendChild(img);
        orbitImgs.push(img);

        setTimeout(() => {
          img.style.opacity = '1';
        }, i * 300);
      });

      setTimeout(() => {
        orbitImgs.forEach((img, i) => {
          img.style.left = `${centerX - img.clientWidth / 2}px`;
          img.style.top = `${centerY - img.clientHeight / 2}px`;
        });
        setTimeout(() => startSecondTyping(), 1500);
      }, images.length * 300 + 1000);
    }

    function startSecondTyping() {
      document.querySelector('.second-message').style.display = 'block';
      typeSound.play().catch(() => {});
      let j = 0;
      const interval2 = setInterval(() => {
        if (j < text2.length) {
          target2.innerHTML += text2.charAt(j);
          j++;
        } else {
          clearInterval(interval2);
          typeSound.pause();
          typeSound.currentTime = 0;

          setTimeout(() => {
            document.querySelector('.message-box').style.display = 'none';
            document.querySelector('.second-message').style.display = 'none';
            moveToHeart();
          }, 3000);
        }
      }, 50);
    }

    function moveToHeart() {
      orbitImgs.forEach(img => img.remove());
      orbitImgs = [];

      const images = Array.from({ length: 20 }, (_, i) => `img${i + 1}.jpg`);
      const centerImg = document.querySelector('.center-img');
      const center = centerImg.getBoundingClientRect();
      const centerX = center.left + center.width / 2;
      const centerY = center.top + center.height / 2;

      images.forEach((filename, i) => {
        const img = document.createElement('img');
        img.src = `./images/${filename}`;
        img.className = 'orbit-img';
        img.style.left = `${centerX - center.width * 0.32}px`;
        img.style.top = `${centerY - center.width * 0.32}px`;
        img.style.opacity = '1';
        img.onerror = () => console.error(`Failed to load image: ${img.src}`);
        document.body.appendChild(img);
        orbitImgs.push(img);
      });

      const heartCenterX = window.innerWidth / 2;
      const heartCenterY = window.innerHeight / 2;
      const scale = Math.min(window.innerWidth, window.innerHeight) / 38;
      const points = [];

      orbitImgs.forEach((img, i) => {
        const t = (Math.PI * 2 * i) / 20;
        const x = 16 * Math.pow(Math.sin(t), 3);
        const y = 13 * Math.cos(t) - 5 * Math.cos(2 * t) - 2 * Math.cos(3 * t) - Math.cos(4 * t);
        const px = heartCenterX + x * scale;
        const py = heartCenterY - y * scale;
        points.push({ x: px, y: py });

        setTimeout(() => {
          img.style.left = `${px - img.clientWidth / 2}px`;
          img.style.top = `${py - img.clientHeight / 2}px`;
        }, i * 150);
      });

      setTimeout(() => {
        let d = `M ${points[0].x},${points[0].y}`;
        for (let i = 1; i < points.length; i++) {
          const p1 = points[i - 1];
          const p2 = points[i];
          const midX = (p1.x + p2.x) / 2;
          const midY = (p1.y + p2.y) / 2;
          d += ` Q ${p1.x},${p1.y} ${midX},${midY}`;
        }
        d += ` Q ${points[points.length - 1].x},${points[points.length - 1].y} ${points[0].x},${points[0].y}`;
        heartCurve.setAttribute('d', d);
        heartCurve.style.animation = 'drawHeart 3s ease forwards';
        setTimeout(() => {
          const coupleText = document.querySelector('.couple-text');
          coupleText.style.display = 'block';
          coupleText.style.opacity = '0';
          coupleText.style.transition = 'opacity 1s ease';
          setTimeout(() => {
            coupleText.style.opacity = '1';
            orbitImgs.forEach(img => img.classList.add('focus-enabled'));
            centerImg.classList.add('focus-enabled');
            setTimeout(showLuckyWheel, 2000);
          }, 100);
        }, 3000);
        triggerFireworks();
      }, orbitImgs.length * 150 + 300);
    }

    function triggerFireworks() {
      let particles = [];
      function createParticle() {
        const x = Math.random() * fireworksCanvas.width;
        const y = Math.random() * fireworksCanvas.height / 2;
        for (let i = 0; i < 30; i++) {
          const angle = Math.random() * 2 * Math.PI;
          const speed = Math.random() * 5 + 2;
          particles.push({
            x,
            y,
            dx: Math.cos(angle) * speed,
            dy: Math.sin(angle) * speed,
            alpha: 1
          });
        }
      }

      setInterval(createParticle, 500);

      function animate() {
        ctx.clearRect(0, 0, fireworksCanvas.width, fireworksCanvas.height);
        particles.forEach((p, i) => {
          p.x += p.dx;
          p.y += p.dy;
          p.alpha -= 0.02;
          if (p.alpha <= 0) particles.splice(i, 1);
          else {
            ctx.fillStyle = `rgba(255,105,180,${p.alpha})`;
            ctx.beginPath();
            ctx.arc(p.x, p.y, 3, 0, 2 * Math.PI);
            ctx.fill();
          }
        });
        requestAnimationFrame(animate);
      }
      animate();
    }

    function showLuckyWheel() {
      const wheelContainer = document.querySelector('.lucky-wheel-container');
      wheelContainer.style.display = 'block';
      initializeWheel();
    }

    function initializeWheel() {
      const wheel = document.getElementById('lucky-wheel');
      const segments = [
        'Chuyến du lịch cùng anh 💕',
        'Bữa tối lãng mạn 🕯️',
        'Một ngày spa thư giãn 🧘‍♀️',
        'Món quà bất ngờ 🎁',
        'Buổi xem phim yêu thích 🎬',
        'Cái ôm thật chặt 🤗',
        'Bó hoa tươi thắm 💐',
        'Bánh ngọt homemade 🧁'
      ];
      const colors = ['#ff69b4', '#ff1493', '#c71585', '#db7093', '#ff4500', '#ff6347', '#ff7f50', '#dc143c'];

      segments.forEach((text, i) => {
        const segment = document.createElement('div');
        segment.className = 'wheel-segment';
        segment.style.background = colors[i];
        segment.style.transform = `rotate(${i * 45}deg)`;
        segment.innerText = text;
        wheel.appendChild(segment);
      });
    }

    let isSpinning = false;
    function spinWheel() {
      if (isSpinning) return;
      isSpinning = true;
      const wheel = document.getElementById('lucky-wheel');
      const resultText = document.getElementById('result-text');
      const spinButton = document.querySelector('.spin-button');
      spinButton.disabled = true;
      resultText.innerText = '';

      const segments = [
        'Chuyến du lịch cùng anh 💕',
        'Bữa tối lãng mạn 🕯️',
        'Ting ting 1 củ 💲',
        'Món quà bất ngờ 🎁',
        'Buổi xem phim yêu thích 🎬',
        'Cái ôm thật chặt 🤗',
        'Ting ting 2 củ 💲💲',
        'Trả bài 2 slot 🧁'
      ];
      const randomIndex = Math.floor(Math.random() * segments.length);
      const rotation = 360 * 5 + randomIndex * 45 + Math.random() * 45;

      wheel.style.transition = 'transform 4s ease-out';
      wheel.style.transform = `rotate(${rotation}deg)`;

      setTimeout(() => {
        isSpinning = false;
        spinButton.disabled = false;
        resultText.innerText = `Chúc mừng! Em nhận được: ${segments[randomIndex]}`;
// Gửi kết quả lên Google Sheet
fetch("https://script.google.com/macros/s/AKfycbx7DyOV7eF6MXtAZiqk265_GwSXYYRbwhidGP7e9q0Noa2gNswQEFc8TxsP__GfwbV7/exec", {
  method: "POST",
  body: JSON.stringify({
    result: `Người nhận đã quay được: ${segments[randomIndex]}`
  }),
  headers: {
    "Content-Type": "application/json"
  }
})
.then(response => response.json())
.then(data => console.log("Kết quả đã ghi vào Google Sheet:", data))
.catch(error => console.error("Lỗi gửi dữ liệu:", error));
      }, 4000);
    }
  </script>
</body>
</html>
